{"version":3,"sources":["../node_modules/process/browser.js","main.js"],"names":["process","module","exports","cachedSetTimeout","cachedClearTimeout","defaultSetTimout","Error","defaultClearTimeout","setTimeout","e","clearTimeout","runTimeout","fun","call","runClearTimeout","marker","queue","draining","currentQueue","queueIndex","cleanUpNextTick","length","concat","drainQueue","timeout","len","run","nextTick","args","Array","arguments","i","push","Item","array","prototype","apply","title","env","argv","version","versions","noop","on","addListener","once","off","removeListener","removeAllListeners","emit","prependListener","prependOnceListener","listeners","name","binding","cwd","chdir","dir","umask","global","keys","Settings","CELL_WIDTH","CELL_HEIGHT","CELL_MARGIN","ANIMATION_SWELLING","ANIMATION_GEN_TIME","FONT_SIZE","State","board","merge","moveCells","move","nextState","_moveUp","_rotate","j","dx","dy","k","ni","nj","result","y","x","value","rot","nextBoard","nextMerge","Math","floor","ny","nx","nextMoveCells","moveCell","fx","fy","tx","ty","cy","num","Game","screen","document","getElementById","animation","Animation","state","v","empty","getEmptyCells","index","random","rewriteCells","generate","isDie","finish","calcNextState","update","bottomCells","cells","pos","Map","itr","cell","Cell","setPos","addY","addX","addNum","progress","time","start","map","forEach","key","console","error","set","proc","timestamp","min","translate","requestAnimationFrame","deleteIndex","animationIndex","addIndex","Date","p","get","changeAttrib","appear","removeChild","elem","delete","type","_initElement","appendChild","posX","posY","style","left","top","height","width","fontSize","sin","PI","lineHeight","textContent","img","createElement","src","sisisinUrl","backgroundImage","sisisin2048","backgroundSize","backgroundColor","color","classList","add","game","addEventListener","keyCode"],"mappings":";AAAA;AACA,IAAIA,OAAO,GAAGC,MAAM,CAACC,OAAP,GAAiB,EAA/B,EAEA;AACA;AACA,ACLA;ADMA;ACLA;ADOA,IAAIC,gBAAJ;AACA,IAAIC,kBAAJ;;AAEA,SAASC,gBAAT,GAA4B;AACxB,QAAM,IAAIC,KAAJ,CAAU,iCAAV,CAAN;AACH;;AACD,SAASC,mBAAT,GAAgC;AAC5B,QAAM,IAAID,KAAJ,CAAU,mCAAV,CAAN;AACH;;AACA,aAAY;AACT,MAAI;AACA,QAAI,OAAOE,UAAP,KAAsB,UAA1B,EAAsC;AAClCL,MAAAA,gBAAgB,GAAGK,UAAnB;AACH,AClBT,IAAImD,CDgBI,KChBE,CDkBK,EClBF;ADmBDxD,AClBVyD,EAAAA,IDkBUzD,AClBN,EAAE,cDkBoB,GAAGE,gBAAnB;AACH,ACpBI,CAAb;ADqBK,ACjBL,GDWI,CAME,ACjBFwD,ODiBSpD,CAAP,ACjBM,EDiBI,CCjBD;ADkBPN,ACjBN2D,EAAAA,EDiBM3D,QCjBI,EAAE,GADC,GDkBS,GAAGE,gBAAnB;AACH,ACjBH0D,EAAAA,WAAW,EAAE,GAFA;AAGbC,EAAAA,WAAW,EAAE,EAHA;ADoBX,AChBFC,EAAAA,IDgBM,cChBY,EAAE,CAJP;ADqBP,AChBNC,EAAAA,MDgBU,OAAOxD,KChBC,EAAE,GALP,EDqBH,KAAwB,UAA5B,EAAwC;AACpCN,AChBV+D,EAAAA,IDgBU/D,KChBD,EAAE,WDgBiB,GAAGM,YAArB;AACH,ACvBM,CAAf,EASA,EDYQ,MAEO;AACHN,MAAAA,kBAAkB,GAAGG,mBAArB;AACH,ICfH6D;ADgBD,ACfH,GDSE,CAME,OAAO3D,CAAP,EAAU,KCfA;ADgBRL,AChBQ,IDgBRA,kBAAkB,GAAGG,mBAArB;AACH;AACJ,ACjBG,CDFH,GAAD;ACGI,SAAK8D,KAAL,GAAa,EAAb,CAFY,CAGZ;ADgBJ,SAAS1D,UAAT,CAAoBC,GAApB,EAAyB;AACrB,AChBA,MDgBIT,GChBCmE,KAAL,GAAa,EAAb,CAJY,CAKZ,CDeoB,KAAK9D,UAAzB,EAAqC;AACjC;AACA,AChBJ,SAAK+D,EDgBM/D,OChBX,GDgBqB,AChBJ,CDgBKI,CChBtB,CANY,CDsBS,ACfrB,EDe2B,CAAN,CAAjB;AACH,ACfD,GDWqB,CAKrB;ACfA;AACA;ADeA,ACdA,MDcI,CAACT,gBAAgB,KAAKE,gBAArB,IAAyC,CAACF,gBAA3C,KAAgEK,UAApE,EAAgF;AAC5EL,IAAAA,gBAAgB,GAAGK,UAAnB;AACA,ACfJ,SAAKgE,EDeMhE,ECfX,GAAY,CAAC,CAAb,GDeqB,CAACI,GAAD,EAAM,CAAN,CAAjB;AACH;ACfD,SAAK,IAAImB,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG,EAApB,EAAwBA,CAAC,EAAzB,EAA6B;ADgB7B,ACfE,MDeE,KCfGsC,KAAL,CAAWrC,IAAX,CAAgB,CAAhB;ADgBE,ACfF,WAAKsC,KAAL,CAAWtC,IAAX,CAAgB,KAAhB;ADgBE,ACfH,WDeU7B,gBAAgB,CAACS,GAAD,EAAM,CAAN,CAAvB;AACH,ACfF,GDYC,CAGE,ACdJ,ODcUH,CAAN,EAAQ;AACN,QAAI;AACA;AACA,aAAON,gBAAgB,CAACU,IAAjB,CAAsB,IAAtB,EAA4BD,GAA5B,EAAiC,CAAjC,CAAP;AACH,KAHD,CAGE,OAAMH,CAAN,EAAQ;AACN,kCClBIgD,KAAK;ADmBT,AClBR,UAAIgB,GDkBWtE,MClBF,GAAG,IAAIiE,GDkBW,CAACvD,CClBhB,EAAhB,CDkBe,ACnBE,CDmBoB,ACjBrC,IDiBe,EAA4BD,GAA5B,EAAiC,CAAjC,CAAP;AACH;AACJ,AClBD,WAAK,IAAImB,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG,EAApB,EAAwBA,CAAC,EAAzB,EAA6B;ADqBhC,ACpBK0C,QAAAA,SAAS,CAACJ,KAAV,CAAgBtC,CAAhB,IAAqB,KAAKsC,KAAL,CAAWtC,CAAX,CAArB;AACD;ADoBL,SAASjB,eAAT,CAAyBC,MAAzB,EAAiC;AAC7B,ACpBA,MDoBIX,ICpBAqD,GAAG,IAAI,CAAX,EAAc,IDoBQ,KAAK/C,YAA3B,EAAyC;AACrC,ACpBF;ADqBE,ACpBF+D,QAAAA,GDoBS/D,MCpBA,CAACgE,KDoBW,CAAC3D,CCpBtB,KDoBqB,CAAnB;AACH,ACpBA,GDgB4B,CAK7B,GCxBA,MAGO,IAAI0C,GAAG,IAAI,CAAX,EAAc;AACnB;AACAgB,QAAAA,SAAS,CAACE,OAAV,CAAkB,CAAlB;ADoBF,MAAI,CAACvE,kBAAkB,KAAKG,mBAAvB,IAA8C,CAACH,kBAAhD,KAAuEM,YAA3E,EAAyF;AACrFN,ACpBFqE,IDoBErE,ICpBFqE,SAAS,CAACC,IDoBU,GAAGhE,ACpBvB,YDoBE;AACA,WAAOA,YAAY,CAACK,MAAD,CAAnB;AACH,ACrBC0D,QAAAA,SAAS,CAACE,OAAV,CAAkB,CAAlB;AACD,OALM,MAKA,IAAIlB,GAAG,IAAI,CAAX,EAAc;ADqBrB,ACpBE,MDoBE;AACA,ACpBFgB,QAAAA,SAAS,CAACE,OAAV,CAAkB,CAAlB;ADqBE,WAAOvE,kBAAkB,CAACW,MAAD,CAAzB;AACH,ACrBC0D,GDkBF,CAGE,ICrBAA,GDqBOhE,CAAP,EAAS,GCrBA,CAACiE,OAAV;ADsBE,QAAI;AACA,ACtBND,QAAAA,SAAS,CAACE,OAAV,CAAkB,CAAlB;ADuBM,ACtBP,OALM,MD2BQvE,ACtBR,kBDsB0B,CAACS,IAAnB,CAAwB,IAAxB,EAA8BE,MAA9B,CAAP;AACH,ACtBH,KDmBE,CAGE,OAAON,CAAP,EAAS;AACP,ACtBNgE,QAAAA,SAAS,CAACE,OAAV,CAAkB,CAAlB;ADuBM;AACA,ACvBNF,QAAAA,KDuBarE,ICvBJ,CAACsE,OAAV,MDuB+B,CAAC7D,IAAnB,CAAwB,IAAxB,EAA8BE,MAA9B,CAAP;AACH;AACJ,ACxBC0D,QAAAA,SAAS,CAACE,OAAV,CAAkB,CAAlB;AD4BL,AC3BI,OAxBgB,CAyBjB;;AD2BJ,IAAI3D,KAAK,GAAG,EAAZ;AACA,AC3BI,ID2BAC,OC3BKuD,CD2BG,GAAG,AC3BX,GAAY,CAAC,CD2BjB,AC3BI;AD4BJ,IAAItD,YAAJ;AACA,AC5BI,ID4BAC,MC5BI,ID4BM,CC5BDoD,ED4BI,CAAC,CAAlB,KC5BQ,CAAelD,MAAf,GAAwB,CAA5B,EAA+B;AAC7B,aAAKmD,IAAL,GAAYf,GAAZ;AD6BN,AC5BK,SD4BIrC,eAAT,GAA2B;AACvB,MAAI,CAACH,QAAD,IAAa,CAACC,YAAlB,EAAgC;AAC5B,AC7BJ,aAAOuD,SAAP;AD8BC,AC7BF,MACD;;AD6BExD,EAAAA,QAAQ,GAAG,KAAX;;AACA,MAAIC,YAAY,CAACG,MAAjB,EAAyB,CC7BnB;AD8BFL,AC7BJ,ID6BIA,KAAK,GAAGE,YAAY,CAACI,MAAb,CAAoBN,KAApB,CAAR;AACH,AC7BD,GD2BA,MAEO,EC7BF,IAAIe,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG,CAApB,EAAuBA,CAAC,EAAxB,EAA4B;AD8BxBZ,AC7BF,ID6BEA,SC7BG,CD6BO,GAAG,AC7BNyD,CD6BO,AC7BN,CD6BR,EC7BW,CAAb,EAAgBA,CAAC,GAAG,CAApB,EAAuBA,CAAC,EAAxB,EAA4B;AD8B7B,AC7BG,cAAI,KAAKP,KAAL,CAAWtC,CAAC,GAAG,CAAJ,GAAQ6C,CAAnB,MAA0B,CAA9B,EAAiC;AAC/B,mBAAO,KAAP;AD6BN,AC5BK,MD4BD5D,KAAK,CAACK,MAAV,EAAkB;AACdE,IAAAA,UAAU;AACb,AC7BG,cAAMsD,EAAE,GAAG,CAAC,CAAD,EAAI,CAAJ,CAAX;AD8BP,AC7BO,cAAMC,EAAE,GAAG,CAAC,CAAD,EAAI,CAAJ,CAAX;;AD+BR,AC9BQ,SD8BCvD,MC9BI,ID8Bb,AC9BiBwD,CAAC,ED8BI,CC9BD,CAAb,EAAgBA,CAAC,GAAG,CAApB,EAAuB,EAAEA,CAAzB,EAA4B;AD+BhC,AC9BM,MD8BF9D,QAAJ,EAAc,AC9BJ+D,EAAE,GAAGjD,CAAC,GAAG+C,EAAE,CAACC,CAAD,CAAf;AD+BF,AC/BE,gBACEE,EAAE,GAAGL,CAAC,GAAGC,EAAE,CAACE,CAAD,CADb;ADgCL;AC9BK,gBAAIC,EAAE,IAAI,CAAN,IAAWC,EAAE,IAAI,CAArB,EAAwB;AD+B9B,AC9BQ,MD8BJzD,OAAO,GAAGb,UAAU,CAACS,eAAD,CAAxB;AACAH,AC9BO,ED8BPA,QAAQ,GAAG,IAAX;AAEA,MAAIQ,GAAG,GAAGT,KAAK,CAACK,MAAhB;AC/BM,gBAAI,KAAKgD,KAAL,CAAWtC,CAAC,GAAG,CAAJ,GAAQ6C,CAAnB,MAA0B,KAAKP,KAAL,CAAWW,EAAE,GAAG,CAAL,GAASC,EAApB,CAA9B,EAAuD;ADgC7D,AC/BQ,SD+BFxD,GAAN,EAAW,OC/BI,KAAP;ADgCJP,AC/BG,ID+BHA,YAAY,GAAGF,KAAf;AACAA,AC/BC,ID+BDA,KAAK,GAAG,EAAR;AC9BD;AD+BC,AC9BH,WD8BU,EAAEG,UAAF,GAAeM,GAAtB,EAA2B;AACvB,UAAIP,YAAJ,EAAkB;AACdA,AC/BZ,QD+BYA,KC/BL,IAAP,GD+BwB,CAACC,UAAD,CAAZ,CAAyBO,GAAzB;AACH,AC/BV,MACD;AD+BO;;AACDP,IAAAA,UAAU,GAAG,CAAC,CAAd;AACAM,IAAAA,GAAG,GAAGT,KAAK,CAACK,MAAZ,cChCU;ADiCb,AChCD,UAAI6D,MAAM,GAAG,EAAb;;ADiCAhE,AChCA,EDgCAA,SChCK,GDgCO,CChCHa,CAAC,CDgCK,EChCF,CAAb,CDgCA,CChCgBA,CAAC,GAAG,EAApB,EAAwBA,CAAC,EAAzB,EAA6B;ADiC7Bd,AChCE,EDgCFA,QAAQ,EChCF,CDgCK,IChCAoD,CDgCX,IChCM,CAAWtC,CAAX,KAAiB,CAArB,EAAwB;ADiC1BjB,AChCIoE,EDgCJpE,QChCIoE,MAAM,CDgCK,AChCJlD,CDgCKR,GChCZ,CAAYO,CAAZ,EDgCW,CAAf;AACH,AChCM;AACF;ADiCL/B,OAAO,CAAC2B,QAAR,GAAmB,UAAUf,GAAV,EAAe;AAC9B,ACjCA,MDiCIgB,IAAI,GAAG,ACjCJsD,IDiCQrD,ECjCf,GDiCW,CAAUC,SAAS,CAACT,MAAV,GAAmB,CAA7B,CAAX;AChCD,MACD;ADgCE,AC/BF,MD+BMS,SAAS,CAACT,MAAV,GAAmB,CAAvB,EAA0B;AACtB,AC/BN,SD+BW,IAAIU,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGD,SAAS,CAACT,MAA9B,EAAsCU,CAAC,EAAvC,EAA2C;AACvCH,MAAAA,IAAI,CAACG,CAAC,GAAG,CAAL,CAAJ,GAAcD,SAAS,CAACC,CAAD,CAAvB;AACH;AACJ;iCCjCUoD,GAAGC,GAAGC,OAAO;ADkCxBrE,ACjCA,EDiCAA,KAAK,CAACgB,GCjCDqC,CDiCL,CAAW,GCjCX,CDiCepC,ACjCJkD,CAAC,GDiCD,ACjCI,CDiCKvE,ACjCT,GDiCA,ACjCQwE,CAAnB,CDiCyBxD,GCjCDyD,CDiCb,CAAX,GCjCA;AACD,MACD;ADgCE,MAAIrE,KAAK,CAACK,MAAN,KAAiB,CAAjB,IAAsB,CAACJ,QAA3B,EAAqC;AACjCN,IAAAA,UAAU,CAACY,UAAD,CAAV;AACH;AACJ,CAXD,EAaA,yBCpCU+D,KAAK;AACX,WAAK,IAAIvD,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGuD,GAApB,EAAyB,EAAEvD,CAA3B,EAA8B;AAC5B,YAAIwD,SAAS,GAAG,EAAhB;ADmCN,AClCM,SDkCGtD,GClCCuD,CDkCV,CAAc5E,GAAd,EAAmBsB,EClCA,GDkCnB,AClCsB,EDkCI,AClCpB;ADmCF,OAAKtB,GAAL,GAAWA,GAAX;AACA,ACnCE,ODmCGsB,KAAL,CCnCO,EDmCMA,ECnCF0C,CAAC,EDmCZ,CCnCe,CAAb,EAAgBA,CAAC,GAAG,EAApB,EAAwB,EAAEA,CAA1B,EAA6B;ADoClC,ACnCO,cAAIO,CAAC,GAAGM,IAAI,CAACC,KAAL,CAAWd,CAAC,GAAG,CAAf,CAAR;AAAA,cACEQ,CAAC,GAAGR,CAAC,GAAG,IAAIO,CADd;ADoCRlD,AClCQ,IDkCJ,CAACE,SAAL,AClCYwD,CDkCGjE,CClCD,EDkCd,CClCiB0D,CAAT,CDkCa,YAAY;AAC7B,ACnCI,ODmCCxE,GAAL,CAASwB,GClCHwD,EDkCN,AClCQ,CDkCO,EClCJ,EDkCX,EAAqB,AClCNT,CADX,IDmCsBjD,KAA1B;AACH,AClCOqD,CDgCR,SChCQA,SAAS,CAACI,EAAE,GAAG,CAAL,GAASC,EAAV,CAAT,GAAyB,KAAKvB,KAAL,CAAWO,CAAX,CAAzB;AACAY,UAAAA,SAAS,CAACG,EAAE,GAAG,CAAL,GAASC,EAAV,CAAT,GAAyB,KAAKtB,KAAL,CAAWM,CAAX,CAAzB;ADkCR5E,ACjCO,ODiCA,CAACqC,KAAR,GAAgB,SAAhB;AAEArC,OAAO,CAACsC,GAAR,GAAc,EAAd;AACAtC,ACnCM,ODmCC,CAACuC,IAAR,CCnCW8B,EDmCI,EAAf,CCnCM,GAAakB,SAAb;ADoCNvF,ACnCM,ODmCC,CAACwC,KCnCG8B,EDmCX,GAAkB,ACnCZ,EDmCN,CCnCmBkB,CDmCG,QCnChB;AACA,YAAIK,aAAa,GAAG,EAApB;ADmCN7F,OAAO,CAACyC,QAAR,GAAmB,EAAnB;AClCM,aAAK,IAAIV,EAAC,GAAG,CAAb,EAAgBA,EAAC,GAAG,KAAKwC,SAAL,CAAelD,MAAnC,EAA2C,EAAEU,EAA7C,EAAgD;ADoCtD,ACnCQ,SDmCCW,IAAT,CCnCcoD,EDmCE,CAAE,KCnCI,GAAG,KAAKvB,SAAL,CAAexC,EAAf,CAAjB;AACA,cAAIgE,EAAE,GAAGD,QAAQ,CAACC,EAAlB;ADoCR/F,ACpCQ,ODoCD,CAAC2C,EAAR,GAAaD,CCnCHsD,EAAE,CDmCZ,ECnCeF,QAAQ,CAACE,EADhB;ADqCRhG,ACrCQ,ODqCD,CAAC4C,MCnCEqD,EAAE,GDmCZ,ACnCeH,GDmCOpD,IAAtB,CCnCuB,CAACuD,EAFhB;ADsCRjG,ACtCQ,ODsCD,CAAC6C,IAAR,ECnCUqD,CDmCKxD,CCnCH,GDmCZ,ACnCeoD,QAAQ,CAACI,EAHhB;ADuCRlG,ACnCQ6F,ODmCD,CAAC/C,ECnCA+C,CDmCR,GAAcnD,IAAd,KCnCqB,CAACV,IAAd,CAAmB;ADoC3BhC,ACpC6B+F,ODoCtB,CAAChD,ICpCqBgD,EAAE,EAAE,IAAIC,EDoCrC,ACpC2B,GDoCFtD,IAAzB;AACA1C,ACrCyCgG,ODqClC,CAAChD,ICrCiCgD,EAAE,EAAED,EAAlB,QDqC3B,GAA6BrD,IAA7B;AACA1C,ACtCiDiG,ODsC1C,CAAChD,IAAR,ACtCiDgD,EAAE,CDsCpCvD,CCtCsC,GDsCrD,CCtCyDwD,EAA9B;ADuC3BlG,ACvC6DkG,ODuCtD,CAAChD,ICvCqDgD,EAAE,EAAED,ODuCjE,GAA0BvD,IAA1B;AACA1C,ACxC2B,ODwCpB,CAACmD,GCxCA,gBDwCR,GAA8BT,IAA9B;ACvCO;ADyCP1C,OAAO,CAACoD,SAAR,GAAoB,UAAUC,IAAV,EAAgB;AAAE,ACxChC,SDwCuC,EAAP,ECxC3BkB,SAAL,GAAiBsB,aAAjB;ADwC2C,ACvC5C,CDuCL;ACtCG,MACD;ADuCF7F,OAAO,CAACsD,OAAR,GAAkB,UAAUD,IAAV,EAAgB;AAC9B,QAAM,IAAI/C,KAAJ,CAAU,kCAAV,CAAN;AACH,CAFD;8BCtCY;AD0CZN,ACzCI,ODyCG,CAACuD,GAAR,GAAc,YAAY;AAAE,ACxCxB,SDwC+B,ECxC1B,CDwCmB,GCxCf4B,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG,CAApB,EAAuBA,CAAC,EAAxB,EAA4B;ADwCQ,ACvClC,CDuCN,YCvCW,IAAIC,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG,CAApB,EAAuBA,CAAC,EAAxB,EAA4B;AAC1B,eAAKd,KAAL,CAAWa,CAAC,GAAG,CAAJ,GAAQC,CAAnB,IAAwB,KAAxB;ADuCRpF,ACtCO,ODsCA,CAACwD,KAAR,GAAgB,UAAUC,GAAV,EAAe;AAC3B,ACtCC,OANO,CD4CF,ACrCN,IDqCUnD,KAAJ,CAAU,gCAAV,CAAN;AACH,CAFD;;AAGAN,ACtCI,ODsCG,CAAC0D,GCtCC,EDsCT,ECtCayB,CDsCG,CCtCF,GAAG,CAAb,EAAgBA,EAAC,GDsCM,ACtCH,CAApB,EAAuBA,EAAC,EAAxB,EAA4B;ADsCH,ACrCvB,SDqC8B,CAAP,GCrClB,IAAIC,EAAC,GAAG,CAAb,EAAgBA,EAAC,GAAG,CAApB,EAAuB,EAAEA,EAAzB,EAA4B;ADqCM,ACpChC,CDoCR,aCpCY,KAAKf,KAAL,CAAWc,EAAC,GAAG,CAAJ,GAAQC,EAAnB,MAA0B,CAA9B,EAAiC;AACjC,cAAIe,EAAE,GAAGhB,EAAT;;AACA,iBAAOgB,EAAE,IAAI,CAAb,EAAgB;AACd,gBAAMC,GAAG,GAAG,KAAK/B,KAAL,CAAW,CAAC8B,EAAE,GAAG,CAAN,IAAW,CAAX,GAAef,EAA1B,CAAZ;;AACA,gBAAIgB,GAAG,KAAK,CAAZ,EAAe;AACb;AACA,mBAAK/B,KAAL,CAAW,CAAC8B,EAAE,GAAG,CAAN,IAAW,CAAX,GAAef,EAA1B,IAA+B,KAAKf,KAAL,CAAW8B,EAAE,GAAG,CAAL,GAASf,EAApB,CAA/B;AACA,mBAAKf,KAAL,CAAW8B,EAAE,GAAG,CAAL,GAASf,EAApB,IAAyB,CAAzB;AACA,gBAAEe,EAAF;AACD,aALD,MAKO,IACLC,GAAG,KAAK,KAAK/B,KAAL,CAAW8B,EAAE,GAAG,CAAL,GAASf,EAApB,CAAR,IACA,CAAC,KAAKd,KAAL,CAAW6B,EAAE,GAAG,CAAL,GAASf,EAApB,CADD,IAEA,CAAC,KAAKd,KAAL,CAAW,CAAC6B,EAAE,GAAG,CAAN,IAAW,CAAX,GAAef,EAA1B,CAHI,EAIL;AACA;AACA,mBAAKf,KAAL,CAAW,CAAC8B,EAAE,GAAG,CAAN,IAAW,CAAX,GAAef,EAA1B,IAA+B,IAAIgB,GAAnC;AACA,mBAAK/B,KAAL,CAAW8B,EAAE,GAAG,CAAL,GAASf,EAApB,IAAyB,CAAzB;AACA,mBAAKd,KAAL,CAAW,CAAC6B,EAAE,GAAG,CAAN,IAAW,CAAX,GAAef,EAA1B,IAA+B,IAA/B;AACA,gBAAEe,EAAF;AACD,aAVM,MAUA;AACL;AACD;AACF;;AACD,cAAIA,EAAE,IAAIhB,EAAV,EAAa;AACX;AACA,iBAAKZ,SAAL,CAAevC,IAAf,CAAoB;AAAE+D,cAAAA,EAAE,EAAEX,EAAN;AAASY,cAAAA,EAAE,EAAEb,EAAb;AAAgBc,cAAAA,EAAE,EAAEb,EAApB;AAAuBc,cAAAA,EAAE,EAAEC;AAA3B,aAApB;AACD;AACF;AACF;AACF;;;;KAGH;;;IACME;AACJ,kBAAc;AAAA;;AACZ;AACA,SAAKC,MAAL,GAAcC,QAAQ,CAACC,cAAT,CAAwB,WAAxB,CAAd;AACA,SAAKC,SAAL,GAAiB,IAAIC,SAAJ,CAAc,KAAKJ,MAAnB,CAAjB;AACA,SAAKK,KAAL,GAAa,IAAIvC,KAAJ,EAAb;AACA,QAAMwC,CAAC,GAAG,CAAC,CAAD,EAAI,CAAJ,EAAO,CAAP,EAAU,EAAV,EAAc,EAAd,EAAkB,EAAlB,EAAsB,GAAtB,EAA2B,GAA3B,EAAgC,GAAhC,EAAqC,IAArC,EAA2C,IAA3C,CAAV,CALY,CAMZ;;AACA,SAAK,IAAI7E,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG6E,CAAC,CAACvF,MAAtB,EAA8BU,CAAC,EAA/B,EAAmC;AACjC,UAAM8E,KAAK,GAAG,KAAKF,KAAL,CAAWG,aAAX,EAAd;AACA,UAAMV,GAAG,GAAGQ,CAAC,CAAC7E,CAAD,CAAb,CAFiC,CAGjC;;AACA,UAAMgF,KAAK,GAAGF,KAAK,CAACpB,IAAI,CAACC,KAAL,CAAWD,IAAI,CAACuB,MAAL,KAAgBH,KAAK,CAACxF,MAAjC,CAAD,CAAnB;AACA,UAAM8D,CAAC,GAAGM,IAAI,CAACC,KAAL,CAAWqB,KAAK,GAAG,CAAnB,CAAV;AAAA,UACE3B,CAAC,GAAG2B,KAAK,GAAG,CADd;AAEA,WAAKJ,KAAL,CAAWM,YAAX,CAAwB9B,CAAxB,EAA2BC,CAA3B,EAA8BgB,GAA9B;AACA,WAAKK,SAAL,CAAeS,QAAf,CAAwB,KAAKZ,MAA7B,EAAqCnB,CAArC,EAAwCC,CAAxC,EAA2CgB,GAA3C,EAAgD,CAAhD;AACD;AACF,IACD;;;;;yBACK3C,KAAK;AACR,UAAI,KAAKkD,KAAL,CAAWQ,KAAX,EAAJ,EAAwB;AACxB,UAAI,CAAC,KAAKV,SAAL,CAAeW,MAApB,EAA4B;AAC5B,UAAI3C,SAAS,GAAG,KAAKkC,KAAL,CAAWU,aAAX,CAAyB5D,GAAzB,CAAhB,CAHQ,CAIR;;AACA,UAAIgB,SAAS,CAACF,SAAV,CAAoBlD,MAApB,GAA6B,CAAjC,EAAoC;AAClC;AACA,YAAMwF,KAAK,GAAGpC,SAAS,CAACqC,aAAV,EAAd;AACA,YAAMV,GAAG,GAAGX,IAAI,CAACuB,MAAL,KAAgB,GAAhB,GAAsB,CAAtB,GAA0B,CAAtC;AACA,YAAMD,KAAK,GAAGF,KAAK,CAACpB,IAAI,CAACC,KAAL,CAAWD,IAAI,CAACuB,MAAL,KAAgBH,KAAK,CAACxF,MAAjC,CAAD,CAAnB;AACA,YAAM8D,CAAC,GAAGM,IAAI,CAACC,KAAL,CAAWqB,KAAK,GAAG,CAAnB,CAAV;AAAA,YACE3B,CAAC,GAAG2B,KAAK,GAAG,CADd,CALkC,CAQlC;;AACAtC,QAAAA,SAAS,CAACwC,YAAV,CAAuB9B,CAAvB,EAA0BC,CAA1B,EAA6BgB,GAA7B,EATkC,CAWlC;;AACA,aAAKK,SAAL,CAAea,MAAf,CAAsB7C,SAAtB,EAAiCU,CAAjC,EAAoCC,CAApC,EAAuCgB,GAAvC,EAZkC,CAclC;;AACA,aAAKO,KAAL,GAAalC,SAAb;AACD;AACF;;;;;;IAGGiC;AACJ,qBAAYJ,MAAZ,EAAoB;AAAA;;AAClB;AACA,SAAKiB,WAAL,GAAmB,EAAnB,CAFkB,CAGlB;;AACA,SAAKC,KAAL,GAAa,EAAb,CAJkB,CAKlB;AACA;;AACA,SAAKC,GAAL,GAAW,IAAIC,GAAJ,EAAX,CAPkB,CAQlB;;AACA,SAAKC,GAAL,GAAW,CAAX;;AACA,SAAK,IAAI5F,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG,EAApB,EAAwBA,CAAC,EAAzB,EAA6B;AAC3B,UAAMoD,CAAC,GAAGM,IAAI,CAACC,KAAL,CAAW3D,CAAC,GAAG,CAAf,CAAV;AAAA,UACEqD,CAAC,GAAGrD,CAAC,GAAG,CADV;AAEA,UAAM6F,IAAI,GAAG,IAAIC,IAAJ,CAAS,CAAT,EAAYvB,MAAZ,CAAb;AACAsB,MAAAA,IAAI,CAACE,MAAL,CAAY3C,CAAZ,EAAeC,CAAf;AACA,WAAKmC,WAAL,CAAiBvF,IAAjB,CAAsB4F,IAAtB;AACD;;AACD,SAAKtB,MAAL,GAAcA,MAAd,CAjBkB,CAkBlB;;AACA,SAAKc,MAAL,GAAc,IAAd;AACD,IACD;AACA;AACA;;;;;2BACOT,OAAOoB,MAAMC,MAAMC,QAAQ;AAAA;;AAChC;AACA,WAAKb,MAAL,GAAc,KAAd,CAFgC,CAGhC;;AACA;AACE,YAAIc,QAAQ,GAAG,CAAf;AACA,YAAMC,IAAI,GAAGtE,QAAQ,CAACK,kBAAtB;AACA,YAAIkE,KAAK,GAAG,IAAZ,CAHF,CAKE;;AACA,YAAIC,GAAG,GAAG,IAAIX,GAAJ,EAAV;;AANF,mDAOqBf,KAAK,CAACpC,SAP3B;AAAA;;AAAA;AAAA;AAAA,gBAOaC,IAPb;AAQI,gBAAIuC,KAAK,GAAG,CAAC,CAAb;;AACA,YAAA,KAAI,CAACU,GAAL,CAASa,OAAT,CAAiB,UAACjD,KAAD,EAAQkD,GAAR,EAAaF,GAAb,EAAqB;AACpC,kBAAIhD,KAAK,CAACD,CAAN,KAAYZ,IAAI,CAACuB,EAAjB,IAAuBV,KAAK,CAACF,CAAN,KAAYX,IAAI,CAACwB,EAA5C,EAAgD;AAC9Ce,gBAAAA,KAAK,GAAGwB,GAAR;AACD;AACF,aAJD;;AAKA,gBAAIxB,KAAK,KAAK,CAAC,CAAf,EAAkB;AAChByB,cAAAA,OAAO,CAACC,KAAR,CAAc,iBAAd;AACA;AACD;;AACDJ,YAAAA,GAAG,CAACK,GAAJ,CAAQ3B,KAAR,EAAevC,IAAf;AAlBJ;;AAOE,8DAAoC;AAAA;;AAAA,qCAShC;AAGH;AAnBH;AAAA;AAAA;AAAA;AAAA;;AAoBE6D,QAAAA,GAAG,CAACC,OAAJ,CAAY,UAACjD,KAAD,EAAQkD,GAAR,EAAaF,GAAb,EAAqB;AAC/B,UAAA,KAAI,CAACZ,GAAL,CAASiB,GAAT,CAAaH,GAAb,EAAkB;AAAEnD,YAAAA,CAAC,EAAEC,KAAK,CAACY,EAAX;AAAed,YAAAA,CAAC,EAAEE,KAAK,CAACa;AAAxB,WAAlB;AACD,SAFD;;AAIA,YAAMyC,IAAI,GAAG,SAAPA,IAAO,CAACC,SAAD,EAAe;AAC1B,cAAI,CAACR,KAAL,EAAY;AACVA,YAAAA,KAAK,GAAGQ,SAAR;AACD;;AACDV,UAAAA,QAAQ,GAAG,CAACU,SAAS,GAAGR,KAAb,IAAsBD,IAAjC;AACAD,UAAAA,QAAQ,GAAGzC,IAAI,CAACoD,GAAL,CAASX,QAAT,EAAmB,CAAnB,CAAX;;AAEA,cAAIA,QAAQ,IAAI,CAAhB,EAAmB;AACjBG,YAAAA,GAAG,CAACC,OAAJ,CAAY,UAACjD,KAAD,EAAQkD,GAAR,EAAaF,GAAb,EAAqB;AAC/B,cAAA,KAAI,CAACb,KAAL,CAAWe,GAAX,EAAgBO,SAAhB,CAA0BzD,KAAK,CAACU,EAAhC,EAAoCV,KAAK,CAACW,EAA1C,EAA8CX,KAAK,CAACY,EAApD,EAAwDZ,KAAK,CAACa,EAA9D,EAAkEgC,QAAlE;AACD,aAFD;AAGD;;AAED,cAAIA,QAAQ,GAAG,CAAf,EAAkB;AAChBa,YAAAA,qBAAqB,CAACJ,IAAD,CAArB;AACD;AACF,SAhBD;;AAiBAI,QAAAA,qBAAqB,CAACJ,IAAD,CAArB;AACD,OA9C+B,CA+ChC;;AACA;AACE;AACA,YAAIK,WAAW,GAAG,EAAlB,CAFF,CAGE;;AACA,YAAIC,cAAc,GAAG,EAArB,CAJF,CAKE;;AALF,qCAMW9D,CANX;AAAA,uCAOaC,CAPb;AAQM,gBAAIuB,KAAK,CAACrC,KAAN,CAAYa,CAAC,GAAG,CAAJ,GAAQC,CAApB,CAAJ,EAA4B;AAC1B;AACA,kBAAI2B,KAAK,GAAG,EAAZ;;AACA,cAAA,KAAI,CAACU,GAAL,CAASa,OAAT,CAAiB,UAACjD,KAAD,EAAQkD,GAAR,EAAaF,GAAb,EAAqB;AACpC,oBAAIhD,KAAK,CAACD,CAAN,KAAYA,CAAZ,IAAiBC,KAAK,CAACF,CAAN,KAAYA,CAAjC,EAAoC;AAClC4B,kBAAAA,KAAK,CAAC/E,IAAN,CAAWuG,GAAX;AACD;AACF,eAJD;;AAKAS,cAAAA,WAAW,CAAChH,IAAZ,CAAiB+E,KAAK,CAAC,CAAD,CAAtB;AACAkC,cAAAA,cAAc,CAACjH,IAAf,CAAoB+E,KAAK,CAAC,CAAD,CAAzB;AACD;AAlBP;;AAOI,eAAK,IAAI3B,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG,CAApB,EAAuB,EAAEA,CAAzB,EAA4B;AAAA,mBAAnBA,CAAmB;AAY3B;AAnBL;;AAME,aAAK,IAAID,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG,CAApB,EAAuB,EAAEA,CAAzB,EAA4B;AAAA,iBAAnBA,CAAmB;AAc3B,SApBH,CAqBE;;;AACA,YAAM+D,QAAQ,GAAG,KAAKvB,GAAL,EAAjB;AACA,aAAKF,GAAL,CAASiB,GAAT,CAAaQ,QAAb,EAAuB;AAAE9D,UAAAA,CAAC,EAAE4C,IAAL;AAAW7C,UAAAA,CAAC,EAAE4C;AAAd,SAAvB;AAEA,YAAIG,SAAQ,GAAG,CAAf;AACA,YAAMC,KAAI,GAAGtE,QAAQ,CAACK,kBAAtB;AACA,YAAIkE,MAAK,GAAG,IAAZ;;AAEA,YAAMO,KAAI,GAAG,SAAPA,KAAO,GAAM;AACjB,cAAI,CAACP,MAAL,EAAY;AACVA,YAAAA,MAAK,GAAG,IAAIe,IAAJ,EAAR;AACA,YAAA,KAAI,CAAC3B,KAAL,CAAW0B,QAAX,IAAuB,IAAIrB,IAAJ,CAASI,MAAT,EAAiB,KAAI,CAAC3B,MAAtB,CAAvB;AACD;;AACD,cAAIsC,SAAS,GAAG,IAAIO,IAAJ,EAAhB;AACAjB,UAAAA,SAAQ,GAAG,CAACU,SAAS,GAAGR,MAAb,IAAsBD,KAAjC;AACAD,UAAAA,SAAQ,GAAGzC,IAAI,CAACoD,GAAL,CAASX,SAAT,EAAmB,CAAnB,CAAX;;AAEA,cAAIA,SAAQ,IAAI,CAAhB,EAAmB;AAAA,wDACCe,cADD;AAAA;;AAAA;AACjB,qEAAkC;AAAA,oBAAzBlC,KAAyB;;AAChC,oBAAIqC,CAAC,GAAG,KAAI,CAAC3B,GAAL,CAAS4B,GAAT,CAAatC,KAAb,CAAR;;AACA,gBAAA,KAAI,CAACS,KAAL,CAAWT,KAAX,EAAkBuC,YAAlB,CAA+B3C,KAAK,CAACtC,KAAN,CAAY+E,CAAC,CAACjE,CAAF,GAAM,CAAN,GAAUiE,CAAC,CAAChE,CAAxB,CAA/B;;AACA,gBAAA,KAAI,CAACoC,KAAL,CAAWT,KAAX,EAAkBwC,MAAlB,CAAyB,KAAI,CAAC9B,GAAL,CAAS4B,GAAT,CAAatC,KAAb,EAAoB5B,CAA7C,EAAgD,KAAI,CAACsC,GAAL,CAAS4B,GAAT,CAAatC,KAAb,EAAoB3B,CAApE,EAAuE8C,SAAvE,EAAiF,CAAjF;AACD;AALgB;AAAA;AAAA;AAAA;AAAA;;AAMjB,YAAA,KAAI,CAACV,KAAL,CAAW0B,QAAX,EAAqBK,MAArB,CAA4BxB,IAA5B,EAAkCC,IAAlC,EAAwCE,SAAxC,EAAkD,CAAlD;AACD;;AAED,cAAIA,SAAQ,GAAG,CAAf,EAAkB;AAChBa,YAAAA,qBAAqB,CAACJ,KAAD,CAArB;AACD,WAFD,MAEO;AACL;AACA,YAAA,KAAI,CAACvB,MAAL,GAAc,IAAd;;AAFK,wDAGa4B,WAHb;AAAA;;AAAA;AAGL,qEAA+B;AAAA,oBAAtBjC,MAAsB;;AAC7B,gBAAA,KAAI,CAACT,MAAL,CAAYkD,WAAZ,CAAwB,KAAI,CAAChC,KAAL,CAAWT,MAAX,EAAkB0C,IAA1C;;AACA,gBAAA,KAAI,CAACjC,KAAL,CAAWT,MAAX,IAAoB,IAApB;;AACA,gBAAA,KAAI,CAACU,GAAL,CAASiC,MAAT,CAAgB3C,MAAhB;AACD;AAPI;AAAA;AAAA;AAAA;AAAA;AAQN;AACF,SA7BD;;AA8BAvG,QAAAA,UAAU,CAACmI,KAAD,EAAO9E,QAAQ,CAACK,kBAAT,GAA8B,GAArC,CAAV;AACD;AACF,MACD;AACA;AACA;AACA;;;;6BACSoC,QAAQnB,GAAGC,GAAGgB,KAAe;AAAA;;AAAA,UAAVuD,IAAU,uEAAH,CAAG;AACpC,UAAI5C,KAAK,GAAG,CAAC,CAAb;AACA,WAAKU,GAAL,CAASa,OAAT,CAAiB,UAACjD,KAAD,EAAQkD,GAAR,EAAaF,GAAb,EAAqB;AACpC,YAAIhD,KAAK,CAACD,CAAN,KAAYA,CAAZ,IAAiBC,KAAK,CAACF,CAAN,KAAYA,CAAjC,EAAoC;AAClC4B,UAAAA,KAAK,GAAGwB,GAAR;AACD;AACF,OAJD;;AAKA,UAAIxB,KAAK,KAAK,CAAC,CAAf,EAAkB;AAChB,aAAKS,KAAL,CAAWT,KAAX,EAAkBuC,YAAlB,CAA+BlD,GAA/B;AACA;AACD;;AACDW,MAAAA,KAAK,GAAG,KAAKY,GAAL,EAAR;AACA,WAAKH,KAAL,CAAWT,KAAX,IAAoB,IAAIc,IAAJ,CAASzB,GAAT,EAAcE,MAAd,CAApB;AACA,WAAKmB,GAAL,CAASiB,GAAT,CAAa3B,KAAb,EAAoB;AAAE3B,QAAAA,CAAC,EAAEA,CAAL;AAAQD,QAAAA,CAAC,EAAEA;AAAX,OAApB;AACA,UAAI+C,QAAQ,GAAG,CAAf;AACA,UAAIE,KAAK,GAAG,IAAZ;AACA,UAAMD,IAAI,GAAGtE,QAAQ,CAACK,kBAAtB;;AAEA,UAAMoD,MAAM,GAAG,SAATA,MAAS,CAACsB,SAAD,EAAe;AAC5B,YAAI,CAACR,KAAL,EAAY;AACVA,UAAAA,KAAK,GAAGQ,SAAR;AACD;;AACDV,QAAAA,QAAQ,GAAG,CAACU,SAAS,GAAGR,KAAb,IAAsBD,IAAjC;AACAD,QAAAA,QAAQ,GAAGzC,IAAI,CAACoD,GAAL,CAASX,QAAT,EAAmB,CAAnB,CAAX;;AAEA,YAAIA,QAAQ,IAAI,CAAhB,EAAmB;AACjB,UAAA,MAAI,CAACV,KAAL,CAAWT,KAAX,EAAkBwC,MAAlB,CAAyBpE,CAAzB,EAA4BC,CAA5B,EAA+B8C,QAA/B,EAAyCyB,IAAzC;AACD;;AAED,YAAIzB,QAAQ,GAAG,CAAf,EAAkB;AAChBa,UAAAA,qBAAqB,CAACzB,MAAD,CAArB;AACD;AACF,OAdD;;AAeAyB,MAAAA,qBAAqB,CAACzB,MAAD,CAArB;AACD;;;;KAGH;;;IACMO;AACJ;AACA;AACA,gBAAYzB,GAAZ,EAAiBE,MAAjB,EAAyB;AAAA;;AACvB,SAAKmD,IAAL,GAAY,KAAKG,YAAL,EAAZ;AACAtD,IAAAA,MAAM,CAACuD,WAAP,CAAmB,KAAKJ,IAAxB;AACA,SAAKH,YAAL,CAAkBlD,GAAlB;AACD,IACD;AACA;AACA;AACA;;;;;8BACUL,IAAIC,IAAIC,IAAIC,IAAIlG,SAAS;AACjC,UAAMoF,CAAC,GAAGW,EAAE,GAAG,CAACE,EAAE,GAAGF,EAAN,IAAY/F,OAA3B;AACA,UAAMmF,CAAC,GAAGa,EAAE,GAAG,CAACE,EAAE,GAAGF,EAAN,IAAYhG,OAA3B;AACA,UAAM8J,IAAI,GAAG1E,CAAC,IAAIvB,QAAQ,CAACC,UAAT,GAAsBD,QAAQ,CAACG,WAAnC,CAAD,GAAmDH,QAAQ,CAACG,WAAzE;AACA,UAAM+F,IAAI,GAAG5E,CAAC,IAAItB,QAAQ,CAACE,WAAT,GAAuBF,QAAQ,CAACG,WAApC,CAAD,GAAoDH,QAAQ,CAACG,WAA1E;AACA,WAAKyF,IAAL,CAAUO,KAAV,CAAgBC,IAAhB,aAA0BH,IAA1B;AACA,WAAKL,IAAL,CAAUO,KAAV,CAAgBE,GAAhB,aAAyBH,IAAzB;AACD,MACD;AACA;;;;2BACO5E,GAAGC,GAAG;AACX,WAAKmE,MAAL,CAAYpE,CAAZ,EAAeC,CAAf,EAAkB,CAAlB;AACD,MACD;AACA;AACA;AACA;;;;2BACOD,GAAGC,GAAG8C,UAAoB;AAAA,UAAVyB,IAAU,uEAAH,CAAG;AAC/B,UAAIQ,MAAM,GAAGtG,QAAQ,CAACE,WAAtB;AACA,UAAIqG,KAAK,GAAGvG,QAAQ,CAACC,UAArB;AACA,UAAIiG,IAAI,GAAG5E,CAAC,IAAItB,QAAQ,CAACE,WAAT,GAAuBF,QAAQ,CAACG,WAApC,CAAD,GAAoDH,QAAQ,CAACG,WAAxE;AACA,UAAI8F,IAAI,GAAG1E,CAAC,IAAIvB,QAAQ,CAACC,UAAT,GAAsBD,QAAQ,CAACG,WAAnC,CAAD,GAAmDH,QAAQ,CAACG,WAAvE;AACA,UAAIqG,QAAQ,GAAGxG,QAAQ,CAACM,SAAxB;;AACA,UAAIwF,IAAI,KAAK,CAAb,EAAgB;AACdQ,QAAAA,MAAM,GAAGtG,QAAQ,CAACE,WAAT,GAAuBmE,QAAhC;AACAkC,QAAAA,KAAK,GAAGvG,QAAQ,CAACC,UAAT,GAAsBoE,QAA9B;AACA4B,QAAAA,IAAI,GACF1E,CAAC,IAAIvB,QAAQ,CAACC,UAAT,GAAsBD,QAAQ,CAACG,WAAnC,CAAD,GACAH,QAAQ,CAACG,WADT,GAEA,CAACH,QAAQ,CAACC,UAAT,GAAsBsG,KAAvB,IAAgC,CAHlC;AAIAL,QAAAA,IAAI,GACF5E,CAAC,IAAItB,QAAQ,CAACE,WAAT,GAAuBF,QAAQ,CAACG,WAApC,CAAD,GACAH,QAAQ,CAACG,WADT,GAEA,CAACH,QAAQ,CAACE,WAAT,GAAuBoG,MAAxB,IAAkC,CAHpC;AAIAE,QAAAA,QAAQ,GAAGxG,QAAQ,CAACM,SAAT,GAAqB+D,QAAhC;AACD,OAZD,MAYO,IAAIyB,IAAI,KAAK,CAAb,EAAgB;AACrBQ,QAAAA,MAAM,GAAGtG,QAAQ,CAACE,WAAT,GAAuBF,QAAQ,CAACI,kBAAT,GAA8BwB,IAAI,CAAC6E,GAAL,CAAS7E,IAAI,CAAC8E,EAAL,GAAUrC,QAAnB,CAA9D;AACAkC,QAAAA,KAAK,GAAGvG,QAAQ,CAACC,UAAT,GAAsBD,QAAQ,CAACI,kBAAT,GAA8BwB,IAAI,CAAC6E,GAAL,CAAS7E,IAAI,CAAC8E,EAAL,GAAUrC,QAAnB,CAA5D;AACA4B,QAAAA,IAAI,GACF1E,CAAC,IAAIvB,QAAQ,CAACC,UAAT,GAAsBD,QAAQ,CAACG,WAAnC,CAAD,GACAH,QAAQ,CAACG,WADT,GAEA,CAACH,QAAQ,CAACC,UAAT,GAAsBsG,KAAvB,IAAgC,CAHlC;AAIAL,QAAAA,IAAI,GACF5E,CAAC,IAAItB,QAAQ,CAACE,WAAT,GAAuBF,QAAQ,CAACG,WAApC,CAAD,GACAH,QAAQ,CAACG,WADT,GAEA,CAACH,QAAQ,CAACE,WAAT,GAAuBoG,MAAxB,IAAkC,CAHpC;AAIAE,QAAAA,QAAQ,GAAGxG,QAAQ,CAACM,SAAT,IAAsBgG,MAAM,GAAGtG,QAAQ,CAACE,WAAxC,CAAX;AACD;;AACD,WAAK0F,IAAL,CAAUO,KAAV,CAAgBC,IAAhB,aAA0BH,IAA1B;AACA,WAAKL,IAAL,CAAUO,KAAV,CAAgBE,GAAhB,aAAyBH,IAAzB;AACA,WAAKN,IAAL,CAAUO,KAAV,CAAgBG,MAAhB,aAA4BA,MAA5B;AACA,WAAKV,IAAL,CAAUO,KAAV,CAAgBI,KAAhB,aAA2BA,KAA3B;AACA,WAAKX,IAAL,CAAUO,KAAV,CAAgBK,QAAhB,aAA8BA,QAA9B;AACA,WAAKZ,IAAL,CAAUO,KAAV,CAAgBQ,UAAhB,aAAgCL,MAAhC;AACD,MACD;;;;iCACa/D,KAAK;AAChB,WAAKqD,IAAL,CAAUgB,WAAV,GAAwBrE,GAAG,GAAG,CAAN,GAAUA,GAAV,GAAgB,EAAxC;;AACA,UAAIA,GAAG,KAAK,CAAZ,EAAe;AACb,YAAIsE,GAAG,GAAGnE,QAAQ,CAACoE,aAAT,CAAuB,KAAvB,CAAV;AACAD,QAAAA,GAAG,CAACE,GAAJ,GAAUC,gBAAV;AACAH,QAAAA,GAAG,CAACN,KAAJ,GAAY,KAAZ;AACA,aAAKX,IAAL,CAAUO,KAAV,CAAgBc,eAAhB,mBAA0CC,iBAA1C;AACA,aAAKtB,IAAL,CAAUO,KAAV,CAAgBgB,cAAhB,GAAiC,OAAjC,CALa,CAMb;AACD;;AACD,WAAK5E,GAAL,GAAWA,GAAX;;AACA,cAAQA,GAAR;AACE,aAAK,CAAL;AACE,eAAKqD,IAAL,CAAUO,KAAV,CAAgBiB,eAAhB,GAAkC,MAAlC;AACA,eAAKxB,IAAL,CAAUO,KAAV,CAAgBkB,KAAhB,GAAwB,MAAxB;AACA;;AACF,aAAK,CAAL;AACE,eAAKzB,IAAL,CAAUO,KAAV,CAAgBiB,eAAhB,GAAkC,MAAlC;AACA,eAAKxB,IAAL,CAAUO,KAAV,CAAgBkB,KAAhB,GAAwB,MAAxB;AACA;;AACF,aAAK,CAAL;AACE,eAAKzB,IAAL,CAAUO,KAAV,CAAgBiB,eAAhB,GAAkC,MAAlC;AACA,eAAKxB,IAAL,CAAUO,KAAV,CAAgBkB,KAAhB,GAAwB,MAAxB;AACA;;AACF,aAAK,CAAL;AACE,eAAKzB,IAAL,CAAUO,KAAV,CAAgBiB,eAAhB,GAAkC,MAAlC;AACA,eAAKxB,IAAL,CAAUO,KAAV,CAAgBkB,KAAhB,GAAwB,MAAxB;AACA;;AACF,aAAK,EAAL;AACE,eAAKzB,IAAL,CAAUO,KAAV,CAAgBiB,eAAhB,GAAkC,MAAlC;AACA,eAAKxB,IAAL,CAAUO,KAAV,CAAgBkB,KAAhB,GAAwB,MAAxB;AACA;;AACF,aAAK,EAAL;AACE,eAAKzB,IAAL,CAAUO,KAAV,CAAgBiB,eAAhB,GAAkC,MAAlC;AACA,eAAKxB,IAAL,CAAUO,KAAV,CAAgBkB,KAAhB,GAAwB,MAAxB;AACA;;AACF,aAAK,EAAL;AACE,eAAKzB,IAAL,CAAUO,KAAV,CAAgBiB,eAAhB,GAAkC,MAAlC;AACA,eAAKxB,IAAL,CAAUO,KAAV,CAAgBkB,KAAhB,GAAwB,MAAxB;AACA;;AACF,aAAK,GAAL;AACE,eAAKzB,IAAL,CAAUO,KAAV,CAAgBiB,eAAhB,GAAkC,MAAlC;AACA,eAAKxB,IAAL,CAAUO,KAAV,CAAgBkB,KAAhB,GAAwB,MAAxB;AACA;;AACF,aAAK,GAAL;AACE,eAAKzB,IAAL,CAAUO,KAAV,CAAgBiB,eAAhB,GAAkC,MAAlC;AACA,eAAKxB,IAAL,CAAUO,KAAV,CAAgBkB,KAAhB,GAAwB,MAAxB;AACA;;AACF,aAAK,GAAL;AACE,eAAKzB,IAAL,CAAUO,KAAV,CAAgBiB,eAAhB,GAAkC,MAAlC;AACA,eAAKxB,IAAL,CAAUO,KAAV,CAAgBkB,KAAhB,GAAwB,MAAxB;AACA;;AACF,aAAK,IAAL;AACE,eAAKzB,IAAL,CAAUO,KAAV,CAAgBiB,eAAhB,GAAkC,MAAlC;AACA,eAAKxB,IAAL,CAAUO,KAAV,CAAgBkB,KAAhB,GAAwB,MAAxB;AACA;;AACF,aAAK,IAAL;AACE,eAAKzB,IAAL,CAAUO,KAAV,CAAgBiB,eAAhB,GAAkC,MAAlC;AACA,eAAKxB,IAAL,CAAUO,KAAV,CAAgBkB,KAAhB,GAAwB,MAAxB;AACA;;AACF;AACE,eAAKzB,IAAL,CAAUO,KAAV,CAAgBiB,eAAhB,GAAkC,MAAlC;AACA,eAAKxB,IAAL,CAAUO,KAAV,CAAgBkB,KAAhB,GAAwB,MAAxB;AACA;AApDJ;AAsDD;;;mCACc;AACb,UAAMhG,MAAM,GAAGqB,QAAQ,CAACoE,aAAT,CAAuB,KAAvB,CAAf;AACAzF,MAAAA,MAAM,CAACiG,SAAP,CAAiBC,GAAjB,CAAqB,UAArB;AACA,aAAOlG,MAAP;AACD;;;;;;AAGH,IAAMmG,IAAI,GAAG,IAAIhF,IAAJ,EAAb,EAEA;;AACAE,QAAQ,CAAC+E,gBAAT,CAA0B,SAA1B,EAAqC,UAAC7K,CAAD,EAAO;AAC1CkD,EAAAA,MAAM,CAACC,IAAP,CAAYnD,CAAC,CAAC8K,OAAd,IAAyB,IAAzB;;AACA,MAAI5H,MAAM,CAACC,IAAP,CAAY,EAAZ,CAAJ,EAAqB;AACnB;AACAyH,IAAAA,IAAI,CAAC7G,IAAL,CAAU,CAAV;AACD,GAHD,MAGO,IAAIb,MAAM,CAACC,IAAP,CAAY,EAAZ,CAAJ,EAAqB;AAC1B;AACAyH,IAAAA,IAAI,CAAC7G,IAAL,CAAU,CAAV;AACD,GAHM,MAGA,IAAIb,MAAM,CAACC,IAAP,CAAY,EAAZ,CAAJ,EAAqB;AAC1B;AACAyH,IAAAA,IAAI,CAAC7G,IAAL,CAAU,CAAV;AACD,GAHM,MAGA,IAAIb,MAAM,CAACC,IAAP,CAAY,EAAZ,CAAJ,EAAqB;AAC1B;AACAyH,IAAAA,IAAI,CAAC7G,IAAL,CAAU,CAAV;AACD,GAHM,MAGA;AACL;AACD;AACF,CAjBD;AAkBA+B,QAAQ,CAAC+E,gBAAT,CAA0B,OAA1B,EAAmC,UAAC7K,CAAD,EAAO;AACxCkD,EAAAA,MAAM,CAACC,IAAP,CAAYnD,CAAC,CAAC8K,OAAd,IAAyB,KAAzB;AACD,CAFD","file":"main.1f19ae8e.js","sourceRoot":"../src","sourcesContent":["// shim for using process in browser\nvar process = module.exports = {};\n\n// cached from whatever global is present so that test runners that stub it\n// don't break things.  But we need to wrap it in a try catch in case it is\n// wrapped in strict mode code which doesn't define any globals.  It's inside a\n// function because try/catches deoptimize in certain engines.\n\nvar cachedSetTimeout;\nvar cachedClearTimeout;\n\nfunction defaultSetTimout() {\n    throw new Error('setTimeout has not been defined');\n}\nfunction defaultClearTimeout () {\n    throw new Error('clearTimeout has not been defined');\n}\n(function () {\n    try {\n        if (typeof setTimeout === 'function') {\n            cachedSetTimeout = setTimeout;\n        } else {\n            cachedSetTimeout = defaultSetTimout;\n        }\n    } catch (e) {\n        cachedSetTimeout = defaultSetTimout;\n    }\n    try {\n        if (typeof clearTimeout === 'function') {\n            cachedClearTimeout = clearTimeout;\n        } else {\n            cachedClearTimeout = defaultClearTimeout;\n        }\n    } catch (e) {\n        cachedClearTimeout = defaultClearTimeout;\n    }\n} ())\nfunction runTimeout(fun) {\n    if (cachedSetTimeout === setTimeout) {\n        //normal enviroments in sane situations\n        return setTimeout(fun, 0);\n    }\n    // if setTimeout wasn't available but was latter defined\n    if ((cachedSetTimeout === defaultSetTimout || !cachedSetTimeout) && setTimeout) {\n        cachedSetTimeout = setTimeout;\n        return setTimeout(fun, 0);\n    }\n    try {\n        // when when somebody has screwed with setTimeout but no I.E. maddness\n        return cachedSetTimeout(fun, 0);\n    } catch(e){\n        try {\n            // When we are in I.E. but the script has been evaled so I.E. doesn't trust the global object when called normally\n            return cachedSetTimeout.call(null, fun, 0);\n        } catch(e){\n            // same as above but when it's a version of I.E. that must have the global object for 'this', hopfully our context correct otherwise it will throw a global error\n            return cachedSetTimeout.call(this, fun, 0);\n        }\n    }\n\n\n}\nfunction runClearTimeout(marker) {\n    if (cachedClearTimeout === clearTimeout) {\n        //normal enviroments in sane situations\n        return clearTimeout(marker);\n    }\n    // if clearTimeout wasn't available but was latter defined\n    if ((cachedClearTimeout === defaultClearTimeout || !cachedClearTimeout) && clearTimeout) {\n        cachedClearTimeout = clearTimeout;\n        return clearTimeout(marker);\n    }\n    try {\n        // when when somebody has screwed with setTimeout but no I.E. maddness\n        return cachedClearTimeout(marker);\n    } catch (e){\n        try {\n            // When we are in I.E. but the script has been evaled so I.E. doesn't  trust the global object when called normally\n            return cachedClearTimeout.call(null, marker);\n        } catch (e){\n            // same as above but when it's a version of I.E. that must have the global object for 'this', hopfully our context correct otherwise it will throw a global error.\n            // Some versions of I.E. have different rules for clearTimeout vs setTimeout\n            return cachedClearTimeout.call(this, marker);\n        }\n    }\n\n\n\n}\nvar queue = [];\nvar draining = false;\nvar currentQueue;\nvar queueIndex = -1;\n\nfunction cleanUpNextTick() {\n    if (!draining || !currentQueue) {\n        return;\n    }\n    draining = false;\n    if (currentQueue.length) {\n        queue = currentQueue.concat(queue);\n    } else {\n        queueIndex = -1;\n    }\n    if (queue.length) {\n        drainQueue();\n    }\n}\n\nfunction drainQueue() {\n    if (draining) {\n        return;\n    }\n    var timeout = runTimeout(cleanUpNextTick);\n    draining = true;\n\n    var len = queue.length;\n    while(len) {\n        currentQueue = queue;\n        queue = [];\n        while (++queueIndex < len) {\n            if (currentQueue) {\n                currentQueue[queueIndex].run();\n            }\n        }\n        queueIndex = -1;\n        len = queue.length;\n    }\n    currentQueue = null;\n    draining = false;\n    runClearTimeout(timeout);\n}\n\nprocess.nextTick = function (fun) {\n    var args = new Array(arguments.length - 1);\n    if (arguments.length > 1) {\n        for (var i = 1; i < arguments.length; i++) {\n            args[i - 1] = arguments[i];\n        }\n    }\n    queue.push(new Item(fun, args));\n    if (queue.length === 1 && !draining) {\n        runTimeout(drainQueue);\n    }\n};\n\n// v8 likes predictible objects\nfunction Item(fun, array) {\n    this.fun = fun;\n    this.array = array;\n}\nItem.prototype.run = function () {\n    this.fun.apply(null, this.array);\n};\nprocess.title = 'browser';\nprocess.browser = true;\nprocess.env = {};\nprocess.argv = [];\nprocess.version = ''; // empty string to avoid regexp issues\nprocess.versions = {};\n\nfunction noop() {}\n\nprocess.on = noop;\nprocess.addListener = noop;\nprocess.once = noop;\nprocess.off = noop;\nprocess.removeListener = noop;\nprocess.removeAllListeners = noop;\nprocess.emit = noop;\nprocess.prependListener = noop;\nprocess.prependOnceListener = noop;\n\nprocess.listeners = function (name) { return [] }\n\nprocess.binding = function (name) {\n    throw new Error('process.binding is not supported');\n};\n\nprocess.cwd = function () { return '/' };\nprocess.chdir = function (dir) {\n    throw new Error('process.chdir is not supported');\n};\nprocess.umask = function() { return 0; };\n","import sisisinUrl from './assets/sisisin.jpg';\nimport sisisin2048 from './assets/sisisin2048.jpg';\n\nlet global = {\n  keys: [],\n};\n\nlet Settings = {\n  CELL_WIDTH: 100,\n  CELL_HEIGHT: 100,\n  CELL_MARGIN: 12,\n  ANIMATION_SWELLING: 8,\n  ANIMATION_GEN_TIME: 100,\n  FONT_SIZE: 40,\n};\n\n// ゲームの状態を管理するクラス\nclass State {\n  constructor() {\n    // 4 * 4 行列で, 各要素にどういう要素が入っているかを管理する\n    this.board = [];\n    // move したときに, 例えば 2 と 2 がくっついたりして merge されたかどうかを管理する\n    this.merge = [];\n    // move したときに, 動いたセルはどこからどこへ行ったのか\n    this.moveCells = [];\n    // move どの向きに移動したのかを求める\n    // 0: up\n    // 1: right\n    // 2: down\n    // 3: left\n    this.move = -1;\n    for (let i = 0; i < 16; i++) {\n      this.board.push(0);\n      this.merge.push(false);\n    }\n  }\n  // 指示された方向に動いた際の次の State を求める\n  calcNextState(dir) {\n    let nextState = new State();\n    // コピーする\n    for (let i = 0; i < 16; i++) {\n      nextState.board[i] = this.board[i];\n    }\n    if (dir == 0) {\n      // up\n      nextState._moveUp();\n    } else if (dir == 1) {\n      // right\n      nextState._rotate(3);\n      nextState._moveUp();\n      nextState._rotate(1);\n    } else if (dir == 2) {\n      // down\n      nextState._rotate(2);\n      nextState._moveUp();\n      nextState._rotate(2);\n    } else {\n      // left\n      nextState._rotate(1);\n      nextState._moveUp();\n      nextState._rotate(3);\n    }\n    // 動いてたら動いてたという情報を与える\n    this.move = -1;\n    if (this.moveCells.length > 0) {\n      this.move = dir;\n    }\n    return nextState;\n  }\n  // 死んでないか確かめる\n  isDie() {\n    // 全部埋まっていて, かつどの隣り合ったセル同士も異なっていたら true\n    for (let i = 0; i < 4; i++) {\n      for (let j = 0; j < 4; j++) {\n        if (this.board[i * 4 + j] === 0) {\n          return false;\n        }\n        const dx = [1, 0];\n        const dy = [0, 1];\n        for (let k = 0; k < 2; ++k) {\n          let ni = i + dy[k],\n            nj = j + dx[k];\n          if (ni >= 4 || nj >= 4) {\n            continue;\n          }\n          if (this.board[i * 4 + j] === this.board[ni * 4 + nj]) {\n            return false;\n          }\n        }\n      }\n    }\n    return true;\n  }\n  // 空き領域を配列にして返す\n  getEmptyCells() {\n    let result = [];\n    for (let i = 0; i < 16; i++) {\n      if (this.board[i] == 0) {\n        result.push(i);\n      }\n    }\n    return result;\n  }\n  // セルの値を書き換える(ランダムに出現するのをイメージ)\n  // だけど別の用途で使ってもいいやという\n  // y, x: 場所\n  rewriteCells(y, x, value) {\n    this.board[y * 4 + x] = value;\n  }\n  // board を時計回りに回転させる\n  _rotate(rot) {\n    for (let i = 0; i < rot; ++i) {\n      let nextBoard = [];\n      let nextMerge = [];\n      for (let j = 0; j < 16; ++j) {\n        let y = Math.floor(j / 4),\n          x = j - 4 * y;\n        let ny = x,\n          nx = 3 - y;\n        nextBoard[ny * 4 + nx] = this.board[j];\n        nextMerge[ny * 4 + nx] = this.merge[j];\n      }\n      this.board = nextBoard;\n      this.merge = nextMerge;\n      let nextMoveCells = [];\n      for (let i = 0; i < this.moveCells.length; ++i) {\n        const moveCell = this.moveCells[i];\n        let fx = moveCell.fx,\n          fy = moveCell.fy,\n          tx = moveCell.tx,\n          ty = moveCell.ty;\n        nextMoveCells.push({ fx: 3 - fy, fy: fx, tx: 3 - ty, ty: tx });\n      }\n      this.moveCells = nextMoveCells;\n    }\n  }\n  // 後 _moveUp が必要ですね\n  _moveUp() {\n    // merge 情報をリセット\n    for (let y = 0; y < 4; y++) {\n      for (let x = 0; x < 4; x++) {\n        this.merge[y * 4 + x] = false;\n      }\n    }\n    // 上から順番に見ていき, くっつけられるならくっつけていく\n    for (let y = 1; y < 4; y++) {\n      for (let x = 0; x < 4; ++x) {\n        if (this.board[y * 4 + x] === 0) continue;\n        let cy = y;\n        while (cy >= 1) {\n          const num = this.board[(cy - 1) * 4 + x];\n          if (num === 0) {\n            // 上が空いてるなら普通に動かす\n            this.board[(cy - 1) * 4 + x] = this.board[cy * 4 + x];\n            this.board[cy * 4 + x] = 0;\n            --cy;\n          } else if (\n            num === this.board[cy * 4 + x] &&\n            !this.merge[cy * 4 + x] &&\n            !this.merge[(cy - 1) * 4 + x]\n          ) {\n            // 上と同じ数なら合体させる\n            this.board[(cy - 1) * 4 + x] = 2 * num;\n            this.board[cy * 4 + x] = 0;\n            this.merge[(cy - 1) * 4 + x] = true;\n            --cy;\n          } else {\n            break;\n          }\n        }\n        if (cy != y) {\n          // 少なくとも一マス動いているので動き情報を記録\n          this.moveCells.push({ fx: x, fy: y, tx: x, ty: cy });\n        }\n      }\n    }\n  }\n}\n\n// Game 全体を管理するクラス\nclass Game {\n  constructor() {\n    // 制御するセルを指定\n    this.screen = document.getElementById('gameBoard');\n    this.animation = new Animation(this.screen);\n    this.state = new State();\n    const v = [2, 4, 8, 16, 32, 64, 128, 256, 512, 1024, 2048];\n    // 初期状態として 2 つ cell を入れておく\n    for (let i = 0; i < v.length; i++) {\n      const empty = this.state.getEmptyCells();\n      const num = v[i];\n      // const num = Math.random() < 0.9 ? 2 : 4;\n      const index = empty[Math.floor(Math.random() * empty.length)];\n      const y = Math.floor(index / 4),\n        x = index % 4;\n      this.state.rewriteCells(y, x, num);\n      this.animation.generate(this.screen, y, x, num, 1);\n    }\n  }\n  // キー入力に対応してゴニョゴニョする\n  move(dir) {\n    if (this.state.isDie()) return;\n    if (!this.animation.finish) return;\n    let nextState = this.state.calcNextState(dir);\n    // いずれかのセルが動いたならば\n    if (nextState.moveCells.length > 0) {\n      // ランダムに数字を挿入する処理\n      const empty = nextState.getEmptyCells();\n      const num = Math.random() < 0.9 ? 2 : 4;\n      const index = empty[Math.floor(Math.random() * empty.length)];\n      const y = Math.floor(index / 4),\n        x = index % 4;\n\n      // なんやかんや\n      nextState.rewriteCells(y, x, num);\n\n      // アニメーション\n      this.animation.update(nextState, y, x, num);\n\n      // state を更新\n      this.state = nextState;\n    }\n  }\n}\n\nclass Animation {\n  constructor(screen) {\n    // 下に並べて置くセル\n    this.bottomCells = [];\n    // 実際に動くセル\n    this.cells = [];\n    // セルの位置を覚えておく\n    // this.cells[i] の位置は this.pos[i] が覚えておく\n    this.pos = new Map();\n    // 新しいセルを出現させるときのイテレーター的な\n    this.itr = 0;\n    for (let i = 0; i < 16; i++) {\n      const y = Math.floor(i / 4),\n        x = i % 4;\n      const cell = new Cell(0, screen);\n      cell.setPos(y, x);\n      this.bottomCells.push(cell);\n    }\n    this.screen = screen;\n    // アニメーションが終了したかどうか\n    this.finish = true;\n  }\n  // 指定したセル群を移動させる -> 合体させる -> 新しい数字が表れる\n  // 引数：State クラス\n  // 最後に merge したところから数字を登場させる\n  update(state, addY, addX, addNum) {\n    // アニメーション開始\n    this.finish = false;\n    // 移動するアニメーション\n    {\n      let progress = 0;\n      const time = Settings.ANIMATION_GEN_TIME;\n      let start = null;\n\n      // index -> 目標位置\n      let map = new Map();\n      for (const move of state.moveCells) {\n        let index = -1;\n        this.pos.forEach((value, key, map) => {\n          if (value.x === move.fx && value.y === move.fy) {\n            index = key;\n          }\n        });\n        if (index === -1) {\n          console.error('cell not found!');\n          continue;\n        }\n        map.set(index, move);\n      }\n      map.forEach((value, key, map) => {\n        this.pos.set(key, { x: value.tx, y: value.ty });\n      });\n\n      const proc = (timestamp) => {\n        if (!start) {\n          start = timestamp;\n        }\n        progress = (timestamp - start) / time;\n        progress = Math.min(progress, 1);\n\n        if (progress >= 0) {\n          map.forEach((value, key, map) => {\n            this.cells[key].translate(value.fx, value.fy, value.tx, value.ty, progress);\n          });\n        }\n\n        if (progress < 1) {\n          requestAnimationFrame(proc);\n        }\n      };\n      requestAnimationFrame(proc);\n    }\n    // 数字が合体して数字が表れるアニメーション\n    {\n      // removeChild する要素の index\n      let deleteIndex = [];\n      // 数を倍にする要素の index\n      let animationIndex = [];\n      // merge が true になる場所に向かっているセルは必ず二つあるので, 一つは delete に入れてもう一つは animation に入れる\n      for (let y = 0; y < 4; ++y) {\n        for (let x = 0; x < 4; ++x) {\n          if (state.merge[y * 4 + x]) {\n            // this.pos から index を二つ探す\n            let index = [];\n            this.pos.forEach((value, key, map) => {\n              if (value.x === x && value.y === y) {\n                index.push(key);\n              }\n            });\n            deleteIndex.push(index[0]);\n            animationIndex.push(index[1]);\n          }\n        }\n      }\n      // 新しく追加する数字\n      const addIndex = this.itr++;\n      this.pos.set(addIndex, { x: addX, y: addY });\n\n      let progress = 0;\n      const time = Settings.ANIMATION_GEN_TIME;\n      let start = null;\n\n      const proc = () => {\n        if (!start) {\n          start = new Date();\n          this.cells[addIndex] = new Cell(addNum, this.screen);\n        }\n        let timestamp = new Date();\n        progress = (timestamp - start) / time;\n        progress = Math.min(progress, 1);\n\n        if (progress >= 0) {\n          for (let index of animationIndex) {\n            let p = this.pos.get(index);\n            this.cells[index].changeAttrib(state.board[p.y * 4 + p.x]);\n            this.cells[index].appear(this.pos.get(index).y, this.pos.get(index).x, progress, 2);\n          }\n          this.cells[addIndex].appear(addY, addX, progress, 1);\n        }\n\n        if (progress < 1) {\n          requestAnimationFrame(proc);\n        } else {\n          // アニメーション終了\n          this.finish = true;\n          for (let index of deleteIndex) {\n            this.screen.removeChild(this.cells[index].elem);\n            this.cells[index] = null;\n            this.pos.delete(index);\n          }\n        }\n      };\n      setTimeout(proc, Settings.ANIMATION_GEN_TIME * 1.1);\n    }\n  }\n  // 数字が表れる\n  // screen: 親要素\n  // [y, x] 座標に num を登場させるアニメーション\n  // type: アニメーションの仕方(0: 特に何も 1: 広がる感じ(ランダムに表れるやつ) 2: 広がってから落ち着く(合体するやつ))\n  generate(screen, y, x, num, type = 0) {\n    let index = -1;\n    this.pos.forEach((value, key, map) => {\n      if (value.x === x && value.y === y) {\n        index = key;\n      }\n    });\n    if (index !== -1) {\n      this.cells[index].changeAttrib(num);\n      return;\n    }\n    index = this.itr++;\n    this.cells[index] = new Cell(num, screen);\n    this.pos.set(index, { x: x, y: y });\n    let progress = 0;\n    let start = null;\n    const time = Settings.ANIMATION_GEN_TIME;\n\n    const update = (timestamp) => {\n      if (!start) {\n        start = timestamp;\n      }\n      progress = (timestamp - start) / time;\n      progress = Math.min(progress, 1);\n\n      if (progress >= 0) {\n        this.cells[index].appear(y, x, progress, type);\n      }\n\n      if (progress < 1) {\n        requestAnimationFrame(update);\n      }\n    };\n    requestAnimationFrame(update);\n  }\n}\n\n// Cell を管理するクラス\nclass Cell {\n  // num: 数字\n  // screen: 親要素\n  constructor(num, screen) {\n    this.elem = this._initElement();\n    screen.appendChild(this.elem);\n    this.changeAttrib(num);\n  }\n  // 移動する\n  // fx, fy: どこから\n  // tx, ty: どこへ\n  // process: 進捗率\n  translate(fx, fy, tx, ty, process) {\n    const x = fx + (tx - fx) * process;\n    const y = fy + (ty - fy) * process;\n    const posX = x * (Settings.CELL_WIDTH + Settings.CELL_MARGIN) + Settings.CELL_MARGIN;\n    const posY = y * (Settings.CELL_HEIGHT + Settings.CELL_MARGIN) + Settings.CELL_MARGIN;\n    this.elem.style.left = `${posX}px`;\n    this.elem.style.top = `${posY}px`;\n  }\n  // セルを配置\n  // y, x: 配置する位置\n  setPos(y, x) {\n    this.appear(y, x, 0);\n  }\n  // 新しいセルが現れるアニメーション\n  // y, x: 出てくる位置\n  // process: 進捗率\n  // type: アニメーションの仕方(0: 特に何も 1: 広がる感じ(ランダムに表れるやつ) 2: 広がってから落ち着く(合体するやつ))\n  appear(y, x, progress, type = 0) {\n    let height = Settings.CELL_HEIGHT;\n    let width = Settings.CELL_WIDTH;\n    let posY = y * (Settings.CELL_HEIGHT + Settings.CELL_MARGIN) + Settings.CELL_MARGIN;\n    let posX = x * (Settings.CELL_WIDTH + Settings.CELL_MARGIN) + Settings.CELL_MARGIN;\n    let fontSize = Settings.FONT_SIZE;\n    if (type === 1) {\n      height = Settings.CELL_HEIGHT * progress;\n      width = Settings.CELL_WIDTH * progress;\n      posX =\n        x * (Settings.CELL_WIDTH + Settings.CELL_MARGIN) +\n        Settings.CELL_MARGIN +\n        (Settings.CELL_WIDTH - width) / 2;\n      posY =\n        y * (Settings.CELL_HEIGHT + Settings.CELL_MARGIN) +\n        Settings.CELL_MARGIN +\n        (Settings.CELL_HEIGHT - height) / 2;\n      fontSize = Settings.FONT_SIZE * progress;\n    } else if (type === 2) {\n      height = Settings.CELL_HEIGHT + Settings.ANIMATION_SWELLING * Math.sin(Math.PI * progress);\n      width = Settings.CELL_WIDTH + Settings.ANIMATION_SWELLING * Math.sin(Math.PI * progress);\n      posX =\n        x * (Settings.CELL_WIDTH + Settings.CELL_MARGIN) +\n        Settings.CELL_MARGIN +\n        (Settings.CELL_WIDTH - width) / 2;\n      posY =\n        y * (Settings.CELL_HEIGHT + Settings.CELL_MARGIN) +\n        Settings.CELL_MARGIN +\n        (Settings.CELL_HEIGHT - height) / 2;\n      fontSize = Settings.FONT_SIZE * (height / Settings.CELL_HEIGHT);\n    }\n    this.elem.style.left = `${posX}px`;\n    this.elem.style.top = `${posY}px`;\n    this.elem.style.height = `${height}px`;\n    this.elem.style.width = `${width}px`;\n    this.elem.style.fontSize = `${fontSize}px`;\n    this.elem.style.lineHeight = `${height}px`;\n  }\n  // セルの値を変更する\n  changeAttrib(num) {\n    this.elem.textContent = num > 0 ? num : '';\n    if (num === 0) {\n      let img = document.createElement('img');\n      img.src = sisisinUrl;\n      img.width = '100';\n      this.elem.style.backgroundImage = `url(\"${sisisin2048}\")`;\n      this.elem.style.backgroundSize = 'cover';\n      // this.elem.appendChild(img);\n    }\n    this.num = num;\n    switch (num) {\n      case 0:\n        this.elem.style.backgroundColor = '#ccc';\n        this.elem.style.color = '#000';\n        break;\n      case 2:\n        this.elem.style.backgroundColor = '#eee';\n        this.elem.style.color = '#000';\n        break;\n      case 4:\n        this.elem.style.backgroundColor = '#eec';\n        this.elem.style.color = '#000';\n        break;\n      case 8:\n        this.elem.style.backgroundColor = '#f93';\n        this.elem.style.color = '#fff';\n        break;\n      case 16:\n        this.elem.style.backgroundColor = '#c66';\n        this.elem.style.color = '#fff';\n        break;\n      case 32:\n        this.elem.style.backgroundColor = '#c33';\n        this.elem.style.color = '#fff';\n        break;\n      case 64:\n        this.elem.style.backgroundColor = '#c11';\n        this.elem.style.color = '#fff';\n        break;\n      case 128:\n        this.elem.style.backgroundColor = '#fc6';\n        this.elem.style.color = '#fff';\n        break;\n      case 256:\n        this.elem.style.backgroundColor = '#fc5';\n        this.elem.style.color = '#fff';\n        break;\n      case 512:\n        this.elem.style.backgroundColor = '#fc3';\n        this.elem.style.color = '#fff';\n        break;\n      case 1024:\n        this.elem.style.backgroundColor = '#fc1';\n        this.elem.style.color = '#fff';\n        break;\n      case 2048:\n        this.elem.style.backgroundColor = '#fc0';\n        this.elem.style.color = '#fff';\n        break;\n      default:\n        this.elem.style.backgroundColor = '#222';\n        this.elem.style.color = '#fff';\n        break;\n    }\n  }\n  _initElement() {\n    const result = document.createElement('div');\n    result.classList.add('gameCell');\n    return result;\n  }\n}\n\nconst game = new Game();\n\n// key 入力\ndocument.addEventListener('keydown', (e) => {\n  global.keys[e.keyCode] = true;\n  if (global.keys[38]) {\n    // up\n    game.move(0);\n  } else if (global.keys[39]) {\n    // right\n    game.move(1);\n  } else if (global.keys[40]) {\n    // down\n    game.move(2);\n  } else if (global.keys[37]) {\n    // left\n    game.move(3);\n  } else {\n    return;\n  }\n});\ndocument.addEventListener('keyup', (e) => {\n  global.keys[e.keyCode] = false;\n});\n"]}